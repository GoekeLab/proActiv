<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Identifying Active and Alternative Promoters from RNA-Seq data with proActiv • proActiv</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Identifying Active and Alternative Promoters from RNA-Seq data with proActiv">
<meta property="og:description" content="proActiv">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">proActiv</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/proActiv.html">
    <span class="fa fa-file-alt"></span>
     
    Complete Analysis Workflow
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-code"></span>
     
    Manual
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GoekeLab/proActiv/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="proActiv_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Identifying Active and Alternative Promoters from RNA-Seq data with proActiv</h1>
                        <h4 class="author">Joseph Lee, Deniz Demircioğlu, Jonathan Göke</h4>
                        
      
      <small class="dont-index">Source: <a href="https://github.com/GoekeLab/proActiv/blob/master/vignettes/proActiv.Rmd"><code>vignettes/proActiv.Rmd</code></a></small>
      <div class="hidden name"><code>proActiv.Rmd</code></div>

    </div>

    
    
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>Most human genes have multiple promoters that control the expression of distinct isoforms. The use of these alternative promoters enables the regulation of isoform expression pre-transcriptionally. Alternative promoters have been found to be important in a wide number of cell types and diseases.</p>
<p>proActiv is a method that enables the analysis of promoters from RNA-Seq data. proActiv uses aligned reads as input, and then generates counts and normalized promoter activity estimates for each annotated promoter. These estimates can then be used to identify which promoter is active, which promoter is inactive, and which promoters change their activity across conditions.</p>
<p>Here we present a quick start guide to using proActiv, and a detailed workflow for identifying active promoters and alternative promoters across 2 conditions.</p>
<p>If you use proActiv in your research, please cite:</p>
<p><a href="https://www.cell.com/cell/fulltext/S0092-8674(19)30906-7">Demircioğlu, Deniz, et al. “A Pan-cancer Transcriptome Analysis Reveals Pervasive Regulation through Alternative Promoters.” <em>Cell</em> 178.6 (2019): 1465-1477.</a></p>
</div>
<div id="contents" class="section level2">
<h2 class="hasAnchor">
<a href="#contents" class="anchor"></a>Contents</h2>
<ul>
<li><a href="#quick-start-quantifying-promoter-activity-with-proactiv">Quick Start: Quantifying promoter activity with proActiv</a></li>
<li>
<a href="#a-complete-workflow-to-identify-alternative-promoter-usage">A complete workflow to identify alternative promoter usage</a>
<ul>
<li><a href="#preparing-input-data">Preparing input data</a></li>
<li><a href="#preparing-promoter-annotations">Preparing promoter annotations</a></li>
<li><a href="#running-proactiv">Running proActiv</a></li>
<li><a href="#alternative-promoter-usage-1">Alternative promoter usage</a></li>
</ul>
</li>
<li>
<a href="#analysis-and-visualization-of-alternative-promoter-usage">Analysis and visualization of alternative promoter usage</a>
<ul>
<li><a href="#alternative-promoter-usage-1">Alternative promoter usage</a></li>
<li><a href="#promoter-category-proportion">Promoter category proportion</a></li>
<li><a href="#majorminor-promoters-by-position">Major/minor promoters by position</a></li>
<li><a href="#major-promoter-activity-and-gene-expression">Major promoter activity and gene expression</a></li>
<li><a href="#t-sne">t-SNE</a></li>
</ul>
</li>
<li><a href="#getting-help">Getting help</a></li>
<li><a href="#citing-proactiv">Citing proActiv</a></li>
<li><a href="#session-information">Session information</a></li>
</ul>
</div>
<div id="quick-start-quantifying-promoter-activity-with-proactiv" class="section level2">
<h2 class="hasAnchor">
<a href="#quick-start-quantifying-promoter-activity-with-proactiv" class="anchor"></a>Quick Start: Quantifying promoter activity with proActiv</h2>
<p>proActiv estimates promoter activity from RNA-Seq data. Promoter activity is defined as the total amount of transcription initiated at each promoter. proActiv takes as input either BAM files or junction files (TopHat2 or STAR), and a promoter annotation object of the relevant genome. An optional argument <code>condition</code> can be supplied, describing the condition corresponding to each input file. Here we demonstrate proActiv with STAR junction files (Human genome GRCh38 Gencode v34) as input:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">proActiv</span>)

<span class="co">## List of STAR junction files as input</span>
<span class="no">files</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">'extdata/vignette/junctions'</span>,
                                <span class="kw">package</span> <span class="kw">=</span> <span class="st">'proActiv'</span>), <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">## Vector describing experimental condition</span>
<span class="no">condition</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'A549'</span>,<span class="st">'HepG2'</span>), <span class="kw">each</span><span class="kw">=</span><span class="fl">3</span>)
<span class="co">## Promoter annotation for human genome GENCODE v34</span>
<span class="no">promoterAnnotation</span> <span class="kw">&lt;-</span> <span class="no">promoterAnnotation.gencode.v34</span>

<span class="no">result</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/proActiv.html">proActiv</a></span>(<span class="kw">files</span> <span class="kw">=</span> <span class="no">files</span>,
                   <span class="kw">promoterAnnotation</span> <span class="kw">=</span> <span class="no">promoterAnnotation</span>,
                   <span class="kw">condition</span> <span class="kw">=</span> <span class="no">condition</span>)</pre></body></html></div>
<p><code>result</code> is a summarizedExperiment object which can be accessed as follows:</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">assays(results)</a></code> returns raw/normalized promoter counts and absolute/relative promoter activity<br>
</li>
<li>
<code><a href="https://rdrr.io/pkg/S4Vectors/man/Annotated-class.html">metadata(results)</a></code> returns gene expression data<br>
</li>
<li>
<code><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">rowData(results)</a></code> returns promoter metadata and summarized absolute promoter activity by conditions</li>
</ul>
</div>
<div id="a-complete-workflow-to-identify-alternative-promoter-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#a-complete-workflow-to-identify-alternative-promoter-usage" class="anchor"></a>A complete workflow to identify alternative promoter usage</h2>
<p>Here we present a complete step-by-step workflow for analysing promoter activity with proActiv and for identifying alternative promoter usage across samples from different conditions. We will compare samples from 2 different cell lines (A549 and HepG2) to identify alternative promoters.</p>
<div id="preparing-input-data" class="section level3">
<h3 class="hasAnchor">
<a href="#preparing-input-data" class="anchor"></a>Preparing input data</h3>
<p>proActiv uses RNA-Seq data to quantify promoter activity. Users have the option of using as input either BAM files, or tab-delimited junction files that are generated when TopHat2 or STAR is used for read alignment.</p>
<p>Below, we demonstrate running <code>proActiv</code> with input STAR junction files. This data is taken from the <a href="https://github.com/GoekeLab/sg-nex-data">SGNEx project</a>. The reference genome used for alignment is Gencode v34 (GRCh38). These files can be found in ‘extdata/vignette/junctions’:</p>
<ul>
<li>extdata/vignette/junctions/SGNEx_A549_Illumina_replicate1-run1.junctions.gz</li>
<li>extdata/vignette/junctions/SGNEx_A549_Illumina_replicate3-run1.junctions.gz</li>
<li>extdata/vignette/junctions/SGNEx_A549_Illumina_replicate5-run1.junctions.gz</li>
<li>extdata/vignette/junctions/SGNEx_HepG2_Illumina_replicate2-run1.junctions.gz</li>
<li>extdata/vignette/junctions/SGNEx_HepG2_Illumina_replicate4-run1.junctions.gz</li>
<li>extdata/vignette/junctions/SGNEx_HepG2_Illumina_replicate5-run1.junctions.gz</li>
</ul>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">files</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">'extdata/vignette/junctions'</span>,
                                <span class="kw">package</span> <span class="kw">=</span> <span class="st">'proActiv'</span>), <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
</div>
<div id="preparing-promoter-annotations" class="section level3">
<h3 class="hasAnchor">
<a href="#preparing-promoter-annotations" class="anchor"></a>Preparing promoter annotations</h3>
<p>In order to quantify promoter activity, proActiv uses a set of promoters based on genome annotations. proActiv allows the creation of a promoter annotation object for any genome from a TxDb object or from a GTF file with the <code>preparePromoterAnnotation</code> function. Users have the option to either pass the file path of the GTF/GFF or TxDb to be used, or use the TxDb object directly as input. proActiv includes pre-calculated promoter annotations for human and mouse genomes:</p>
<ul>
<li>GENCODE Release 19 / GRCh37 / hg19 : <code>promoterAnnotation.gencode.v19</code>
</li>
<li>GENCODE Release 34 / GRCh38 / hg38 : <code>promoterAnnotation.gencode.v34</code>
</li>
<li>GENCODE Release M1 / NCBIM37 / mm9 : <code>promoterAnnotation.gencode.vM1</code>
</li>
<li>GENCODE Release M25 / GRCm38.p6 / mm10 : <code>promoterAnnotation.gencode.vM25</code>
</li>
</ul>
<p>GTF files can be downloaded from the <a href="https://www.gencodegenes.org">GENCODE</a> page.</p>
<p>Here, we demonstrate creating the promoter annotation for the Human genome (GENCODE v34) with both GTF and TxDb. To keep the run-time of this vignette small, we use a subset of the GTF/TxDb which includes only chromosome 22 annotations.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co">## From GTF file path</span>
<span class="no">gtf.file</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">'extdata/vignette/annotation/gencode.v34.annotation.chr22.gtf.gz'</span>,
                        <span class="kw">package</span> <span class="kw">=</span> <span class="st">'proActiv'</span>)
<span class="no">promoterAnnotation.gencode.v34.chr22</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/preparePromoterAnnotation.html">preparePromoterAnnotation</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="no">gtf.file</span>,
                                                                  <span class="kw">species</span> <span class="kw">=</span> <span class="st">'Homo_sapiens'</span>)
<span class="co">## From TxDb object</span>
<span class="no">txdb.file</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">'extdata/vignette/annotation/gencode.v34.annotation.chr22.sqlite'</span>,
                         <span class="kw">package</span> <span class="kw">=</span> <span class="st">'proActiv'</span>)
<span class="no">txdb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">loadDb</a></span>(<span class="no">txdb.file</span>)
<span class="no">promoterAnnotation.gencode.v34.chr22</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/preparePromoterAnnotation.html">preparePromoterAnnotation</a></span>(<span class="kw">txdb</span> <span class="kw">=</span> <span class="no">txdb</span>,
                                                                  <span class="kw">species</span> <span class="kw">=</span> <span class="st">'Homo_sapiens'</span>)</pre></body></html></div>
<p>The <code>PromoterAnnotation</code> object has 3 slots:</p>
<ul>
<li>
<code>intronRanges</code> : Intron ranges, giving the corresponding transcripts of each intron</li>
<li>
<code>promoterIdMapping</code> : An ID mapping between transcripts, promoter IDs and gene IDs<br>
</li>
<li>
<code>promoterCoordinates</code> : Promoter coordinates (TSS) and internal promoter state, along with the 3’ coordinate of the first exon</li>
</ul>
</div>
<div id="running-proactiv" class="section level3">
<h3 class="hasAnchor">
<a href="#running-proactiv" class="anchor"></a>Running proActiv</h3>
<p>Once promoters in the genome are identified, proActiv estimates promoter activity at each annotated promoter. Here, we load pre-calculated promoter annotation for GENCODE Release 34. We also supply the experimental condition to <code>proActiv</code>. This information allows <code>proActiv</code> to summarize results across conditions.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">promoterAnnotation</span> <span class="kw">&lt;-</span> <span class="no">promoterAnnotation.gencode.v34</span>

<span class="no">condition</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'A549'</span>, <span class="st">'HepG2'</span>), <span class="kw">each</span><span class="kw">=</span><span class="fl">3</span>)

<span class="no">result</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/proActiv.html">proActiv</a></span>(<span class="kw">files</span> <span class="kw">=</span> <span class="no">files</span>,
                   <span class="kw">promoterAnnotation</span> <span class="kw">=</span> <span class="no">promoterAnnotation</span>,
                   <span class="kw">condition</span> <span class="kw">=</span> <span class="no">condition</span>)</pre></body></html></div>
<p><code>result</code> is a <code>SummarizedExperiment</code> object with assays as raw/normalized promoter counts, and absolute/relative promoter activity:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu">show</span>(<span class="no">result</span>)
<span class="co">#&gt; class: SummarizedExperiment </span>
<span class="co">#&gt; dim: 122635 6 </span>
<span class="co">#&gt; metadata(1): geneExpression</span>
<span class="co">#&gt; assays(4): promoterCounts normalizedPromoterCounts</span>
<span class="co">#&gt;   absolutePromoterActivity relativePromoterActivity</span>
<span class="co">#&gt; rownames(122635): 1 2 ... 122634 122635</span>
<span class="co">#&gt; rowData names(12): promoterId geneId ... A549.class HepG2.class</span>
<span class="co">#&gt; colnames(6): SGNEx_A549_Illumina_replicate1.run1</span>
<span class="co">#&gt;   SGNEx_A549_Illumina_replicate3.run1 ...</span>
<span class="co">#&gt;   SGNEx_HepG2_Illumina_replicate4.run1</span>
<span class="co">#&gt;   SGNEx_HepG2_Illumina_replicate5.run1</span>
<span class="co">#&gt; colData names(2): sampleName condition</span></pre></body></html></div>
<p>The <code>rowData</code> slot stores a promoter-gene ID mapping and promoter position (5’ to 3’) for each promoter by gene. Mean absolute promoter activity for each condition is also summarized here. Promoters are also categorized into three classes. Promoters with activity &lt; 0.25 are classified as inactive, while the most active promoters of each gene are classified as major promoters. Promoters active at lower levels are classified as minor promoters.</p>
<table class="table">
<colgroup>
<col width="7%">
<col width="12%">
<col width="6%">
<col width="6%">
<col width="4%">
<col width="11%">
<col width="11%">
<col width="8%">
<col width="6%">
<col width="7%">
<col width="7%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="right">promoterId</th>
<th align="left">geneId</th>
<th align="left">seqnames</th>
<th align="right">start</th>
<th align="left">strand</th>
<th align="left">internalPromoter</th>
<th align="right">promoterPosition</th>
<th align="left">txId</th>
<th align="right">A549.mean</th>
<th align="right">HepG2.mean</th>
<th align="left">A549.class</th>
<th align="left">HepG2.class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">ENSG00000000003.15</td>
<td align="left">chrX</td>
<td align="right">100637104</td>
<td align="left">-</td>
<td align="left">TRUE</td>
<td align="right">2</td>
<td align="left">ENST0000….</td>
<td align="right">7.232193</td>
<td align="right">8.374666</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">ENSG00000000003.15</td>
<td align="left">chrX</td>
<td align="right">100639991</td>
<td align="left">-</td>
<td align="left">FALSE</td>
<td align="right">1</td>
<td align="left">ENST0000….</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="left">Inactive</td>
<td align="left">Inactive</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">ENSG00000000005.6</td>
<td align="left">chrX</td>
<td align="right">100584936</td>
<td align="left">+</td>
<td align="left">FALSE</td>
<td align="right">1</td>
<td align="left">ENST0000….</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="left">Inactive</td>
<td align="left">Inactive</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">ENSG00000000005.6</td>
<td align="left">chrX</td>
<td align="right">100593624</td>
<td align="left">+</td>
<td align="left">TRUE</td>
<td align="right">2</td>
<td align="left">ENST0000….</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">ENSG00000000419.12</td>
<td align="left">chr20</td>
<td align="right">50945861</td>
<td align="left">-</td>
<td align="left">TRUE</td>
<td align="right">2</td>
<td align="left">ENST0000….</td>
<td align="right">8.760939</td>
<td align="right">10.023193</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">ENSG00000000419.12</td>
<td align="left">chr20</td>
<td align="right">50958555</td>
<td align="left">-</td>
<td align="left">FALSE</td>
<td align="right">1</td>
<td align="left">ENST0000….</td>
<td align="right">8.426331</td>
<td align="right">9.642849</td>
<td align="left">Minor</td>
<td align="left">Minor</td>
</tr>
</tbody>
</table>
<p>The <code>metadata</code> slot provides gene expression data for each replicate per condition, and also summarizes mean expression across conditions.</p>
<p>For cleaner downstream analysis, one can remove single-exon transcripts for which promoter activity is not quantified. <code>result</code> can be filtered as such:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co">## Removes single-exon transcripts / promoters by eliminating promoter counts that are NA </span>
<span class="no">result</span> <span class="kw">&lt;-</span> <span class="no">result</span>[<span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">assays</a></span>(<span class="no">result</span>)$<span class="no">promoterCounts</span>),]</pre></body></html></div>
</div>
<div id="alternative-promoter-usage" class="section level3">
<h3 class="hasAnchor">
<a href="#alternative-promoter-usage" class="anchor"></a>Alternative promoter usage</h3>
<p>We identify genes with similar expression levels across cell lines with alternate promoter usage using <a href="https://bioconductor.org/packages/release/bioc/html/DEXSeq.html">DEXSeq</a> (Anders, Reyes, Huber 2012). While DEXSeq is originally intended for inferring differential exon usage in RNA-Seq data, DEXSeq can be similarly used with raw promoter counts as input to assess the statistical significance of alternative promoter usage across conditions. We follow the standard <a href="https://bioconductor.org/packages/devel/bioc/vignettes/DEXSeq/inst/doc/DEXSeq.html#3_counting_reads">DEXSeq workflow</a>. To keep the run-time of this vignette short, we focus only on annotated promoters from chromosome 1.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">DEXSeq</span>)

<span class="co">## Subset to chromosome 1</span>
<span class="no">result.chr</span> <span class="kw">&lt;-</span> <span class="no">result</span>[<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">rowData</a></span>(<span class="no">result</span>)$<span class="no">seqnames</span> <span class="kw">==</span> <span class="st">'chr1'</span>, ]
<span class="no">countData</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">assays</a></span>(<span class="no">result.chr</span>)$<span class="no">promoterCounts</span>, <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">rowData</a></span>(<span class="no">result.chr</span>))

<span class="co">## Call DEXSeq - promoter as feature, gene as group</span>
<span class="no">dxd</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DEXSeq/man/DEXSeqDataSet.html">DEXSeqDataSet</a></span>(<span class="kw">countData</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">countData</span>[,<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">condition</span>))]),
                     <span class="kw">sampleData</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">colData</a></span>(<span class="no">result.chr</span>)),
                     <span class="kw">design</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span>(~ <span class="no">sample</span> + <span class="no">exon</span> + <span class="no">condition</span>:<span class="no">exon</span>),
                     <span class="kw">featureID</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">countData</span>$<span class="no">promoterId</span>),
                     <span class="kw">groupID</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">countData</span>$<span class="no">geneId</span>))
<span class="no">dxr1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DEXSeq/man/DEXSeq.html">DEXSeq</a></span>(<span class="no">dxd</span>)</pre></body></html></div>
<p><code>DEXSeq</code> returns <code>dxr1</code>, which provides the significance that a promoter is differentially used across conditions. The description of each column of <code>dxr1</code> can be found in the metadata columns.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu">mcols</span>(<span class="no">dxr1</span>)$<span class="no">description</span>
<span class="co">#&gt;  [1] "group/gene identifier"                                       </span>
<span class="co">#&gt;  [2] "feature/exon identifier"                                     </span>
<span class="co">#&gt;  [3] "mean of the counts across samples in each feature/exon"      </span>
<span class="co">#&gt;  [4] "exon dispersion estimate"                                    </span>
<span class="co">#&gt;  [5] "LRT statistic: full vs reduced"                              </span>
<span class="co">#&gt;  [6] "LRT p-value: full vs reduced"                                </span>
<span class="co">#&gt;  [7] "BH adjusted p-values"                                        </span>
<span class="co">#&gt;  [8] "exon usage coefficient"                                      </span>
<span class="co">#&gt;  [9] "exon usage coefficient"                                      </span>
<span class="co">#&gt; [10] "relative exon usage fold change"                             </span>
<span class="co">#&gt; [11] "GRanges object of the coordinates of the exon/feature"       </span>
<span class="co">#&gt; [12] "matrix of integer counts, of each column containing a sample"</span></pre></body></html></div>
<p>Users can sort this result by the minimum adjusted p-value for all promoters belonging to a particular gene. This helps to better identify candidate genes where alternative promoter usage is present.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co">## Arrange by minimum padj for each gene</span>
<span class="no">dxr1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">dxr1</span>[,<span class="fl">1</span>:<span class="fl">10</span>]) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">groupID</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">minp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">padj</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">minp</span>)</pre></body></html></div>
<table class="table">
<colgroup>
<col width="14%">
<col width="7%">
<col width="9%">
<col width="8%">
<col width="9%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="8%">
<col width="15%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="left">groupID</th>
<th align="left">featureID</th>
<th align="right">exonBaseMean</th>
<th align="right">dispersion</th>
<th align="right">stat</th>
<th align="right">pvalue</th>
<th align="right">padj</th>
<th align="right">A549</th>
<th align="right">HepG2</th>
<th align="right">log2fold_HepG2_A549</th>
<th align="right">minp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ENSG00000188643.11</td>
<td align="left">64678</td>
<td align="right">3.979751</td>
<td align="right">0.1640159</td>
<td align="right">6.8819194</td>
<td align="right">0.0087072</td>
<td align="right">0.1336423</td>
<td align="right">1.896934</td>
<td align="right">5.0650368</td>
<td align="right">2.8348227</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">ENSG00000188643.11</td>
<td align="left">64679</td>
<td align="right">192.189827</td>
<td align="right">0.0205679</td>
<td align="right">124.5279493</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">16.797190</td>
<td align="right">29.5673494</td>
<td align="right">1.6587650</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">ENSG00000188643.11</td>
<td align="left">64680</td>
<td align="right">421.024030</td>
<td align="right">0.0155623</td>
<td align="right">162.1108438</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">33.458017</td>
<td align="right">21.1079539</td>
<td align="right">-1.3600430</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">ENSG00000076864.19</td>
<td align="left">7051</td>
<td align="right">81.989063</td>
<td align="right">0.0182362</td>
<td align="right">0.3523538</td>
<td align="right">0.5527837</td>
<td align="right">0.9572135</td>
<td align="right">14.241615</td>
<td align="right">14.9892335</td>
<td align="right">0.1486338</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">ENSG00000076864.19</td>
<td align="left">7052</td>
<td align="right">18.072324</td>
<td align="right">0.0358733</td>
<td align="right">82.8734191</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">9.256747</td>
<td align="right">0.9819602</td>
<td align="right">-6.4774424</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">ENSG00000076864.19</td>
<td align="left">7053</td>
<td align="right">6.096055</td>
<td align="right">0.0237063</td>
<td align="right">32.3210817</td>
<td align="right">0.0000000</td>
<td align="right">0.0000017</td>
<td align="right">5.299266</td>
<td align="right">0.9821421</td>
<td align="right">-4.8648275</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="analysis-and-visualization-of-alternative-promoter-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-and-visualization-of-alternative-promoter-usage" class="anchor"></a>Analysis and visualization of alternative promoter usage</h2>
<p>Here we offer several visualizations of the data returned by the workflow above.</p>
<div id="alternative-promoter-usage-1" class="section level3">
<h3 class="hasAnchor">
<a href="#alternative-promoter-usage-1" class="anchor"></a>Alternative Promoter Usage</h3>
<p>To visualize genes with alternative promoter usage across conditions, we call <code>plotPromoters</code> on the summarizedExperiment object <code>result</code> returned by proActiv. Here, we demonstrate <code>plotPromoters</code> by visualizing promoters of RAP1GAP (ENSG00000076864.19). RAP1GAP is the second most significant gene identified in <code>dxr1</code> as a candidate for alternative promoter usage across cell lines A549 and HepG2. <code>plotPromoters</code> takes in <code>result</code> and <code>gene</code>, a gene of interest.</p>
<p>In order to build and plot a transcript model for the gene of interest, users may supply either a transcript database (<code>txdb</code>) or a list of Genomic Ranges giving the ranges of exons by transcripts to be plotted (<code>ranges</code>). If users choose to use a TxDb as input, we recommend that the TxDb used should be the same as the one used to prepare promoter annotations, as annotations from different sources may differ slightly. To keep the run-time of this vignette short, we use a TxDb generated from GENCODE v34 GTF subsetted to RAP1GAP.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co">## RAP1GAP</span>
<span class="no">gene</span> <span class="kw">&lt;-</span> <span class="st">'ENSG00000076864.19'</span>
<span class="no">txdb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">loadDb</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">'extdata/vignette/annotations'</span>,
                           <span class="st">'gencode.v34.annotation.rap1gap.sqlite'</span>,
                           <span class="kw">package</span> <span class="kw">=</span> <span class="st">'proActiv'</span>))
<span class="fu"><a href="../reference/plotPromoters.html">plotPromoters</a></span>(<span class="kw">result</span> <span class="kw">=</span> <span class="no">result</span>, <span class="kw">gene</span> <span class="kw">=</span> <span class="no">gene</span>, <span class="kw">txdb</span> <span class="kw">=</span> <span class="no">txdb</span>)
<span class="co">#&gt; [1] "Plotting ENSG00000076864.19"</span>
<span class="co">#&gt; [1] "Creating Gene Region Track..."</span>
<span class="co">#&gt; [1] "Creating Data Track..."</span>
<span class="co">#&gt; [1] "Creating Annotation Track..."</span>
<span class="co">#&gt; [1] "Creating Plot..."</span></pre></body></html></div>
<p><img src="proActiv_files/figure-html/VizAlternativePromoters%20txdb-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The same plot can be generated with a list of Genomic Ranges giving the exons by transcripts of RAP1GAP:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">ranges</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">'extdata/vignette/annotations'</span>,
                              <span class="st">'exonsBy.rap1gap.rds'</span>,
                              <span class="kw">package</span> <span class="kw">=</span> <span class="st">'proActiv'</span>))
<span class="fu"><a href="../reference/plotPromoters.html">plotPromoters</a></span>(<span class="kw">result</span> <span class="kw">=</span> <span class="no">result</span>, <span class="kw">gene</span> <span class="kw">=</span> <span class="no">gene</span>, <span class="kw">ranges</span> <span class="kw">=</span> <span class="no">ranges</span>)</pre></body></html></div>
<p>Users can adjust the width of the promoter ‘blocks’ and ‘arrows’ in the plot with the numeric arguments <code>blk.width</code> and <code>arrow.width</code> respectively. <code>blk.width</code> defaults to 500 (bases), while <code>arrow.width</code> is internally calculated based on the range of the gene. Other parameters controlling the fill and border colour and size of labels are listed in code documentation.</p>
<p>From the plot, it is clear that alternative promoter usage regulates the expression of RAP1GAP across the cell lines A549 and HepG2.</p>
</div>
<div id="promoter-category-proportion" class="section level3">
<h3 class="hasAnchor">
<a href="#promoter-category-proportion" class="anchor"></a>Promoter category proportion</h3>
<p>Here, we visualize the categorization of annotated promoters in the two cell lines. The proportions between the categories are similar across the two cell lines, with majority of the promoters being inactive.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)

<span class="no">rdata</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">rowData</a></span>(<span class="no">result</span>)
<span class="co">## Create a long dataframe summarizing cell line and promoter class</span>
<span class="no">pdata1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">cellLine</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'A549'</span>, <span class="st">'HepG2'</span>), <span class="kw">each</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">rdata</span>)),
                       <span class="kw">promoterClass</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">rdata</span>$<span class="no">A549.class</span>, <span class="no">rdata</span>$<span class="no">HepG2.class</span>)))

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="no">pdata1</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">cellLine</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">promoterClass</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">'Cell Lines'</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">'Count'</span>) +  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="st">'Promoter Category'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">'Categorization of Promoters'</span>)</pre></body></html></div>
<p><img src="proActiv_files/figure-html/VizPromoterCategories-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="majorminor-promoters-by-position" class="section level3">
<h3 class="hasAnchor">
<a href="#majorminor-promoters-by-position" class="anchor"></a>Major/minor promoters by position</h3>
<p>Analysis of major:minor promoter proportions against promoter position. The analysis is restricted to multi-promoter genes with at least one active promoter. Below, we generate the plot for cell line A549. In general, the major:minor promoter proportion decreases with increasing promoter position.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co">## Because many genes have many annotated promoters, we collapse promoters </span>
<span class="co">## from the 5th position and onward into one group for simplicity</span>
<span class="no">pdata2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>(<span class="no">rdata</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">promoterPosition</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">promoterPosition</span> <span class="kw">&gt;</span> <span class="fl">5</span>, <span class="fl">5</span>, <span class="no">promoterPosition</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">A549.class</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Major'</span>, <span class="st">'Minor'</span>))

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">pdata2</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">promoterPosition</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">A549.class</span>)), <span class="kw">position</span> <span class="kw">=</span> <span class="st">'fill'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">Promoter</span> ~ <span class="no">Position</span> ~ <span class="st">"5'"</span> <span class="kw">%-&gt;%</span> <span class="st">"3'"</span>)) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">'Percentage'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="st">'Promoter Category'</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">'Major/Minor Promoter Proportion in A549'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">1</span>, <span class="fl">0.25</span>), <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">100</span>,<span class="fl">25</span>),<span class="st">'%'</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>,<span class="fl">5</span>), <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'1'</span>,<span class="st">'2'</span>,<span class="st">'3'</span>,<span class="st">'4'</span>,<span class="st">'&gt;=5'</span>))</pre></body></html></div>
<p><img src="proActiv_files/figure-html/VizMajorMinorPosition-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="major-promoter-activity-and-gene-expression" class="section level3">
<h3 class="hasAnchor">
<a href="#major-promoter-activity-and-gene-expression" class="anchor"></a>Major promoter activity and gene expression</h3>
<p>Comparison of major promoter activity and gene expression, calculated by summing over all promoters. Single promoter genes lie on the diagonal. Multi-promoter genes lie to the right of the diagonal. Below, we generate the plot for cell line A549. This plot suggests that a single major promoter does not often fully explain gene expression, with minor promoters also contributing to gene expression.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co">## Get active major promoters of A549</span>
<span class="no">majorPromoter</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>(<span class="no">rdata</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">geneId</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">promoterCount</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span>()) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">A549.class</span> <span class="kw">==</span> <span class="st">'Major'</span>)
<span class="co">## Get gene expression corresponding to the genes identified above</span>
<span class="no">geneExpression</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Annotated-class.html">metadata</a></span>(<span class="no">result</span>)$<span class="no">geneExpression</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">'geneId'</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">geneId</span> <span class="kw">%in%</span> <span class="no">majorPromoter</span>$<span class="no">geneId</span>)

<span class="no">pdata3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">proActiv</span> <span class="kw">=</span> <span class="no">majorPromoter</span>$<span class="no">A549.mean</span>,
                     <span class="kw">geneExp</span> <span class="kw">=</span> <span class="no">geneExpression</span>$<span class="no">A549.mean</span>[<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">majorPromoter</span>$<span class="no">geneId</span>,
                                                              <span class="no">geneExpression</span>$<span class="no">geneId</span>)],
                     <span class="kw">promoterCount</span> <span class="kw">=</span> <span class="no">majorPromoter</span>$<span class="no">promoterCount</span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">pdata3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">geneExp</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">proActiv</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="no">promoterCount</span>), <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">'Major Promoter Activity vs. Gene Expression in A549'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">'Average Gene Expression'</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">'Average Major Promoter Activity'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="st">'Number of \n Annotated Promoters'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span>(<span class="kw">slope</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">intercept</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="st">'red'</span>, <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">'dashed'</span>)</pre></body></html></div>
<p><img src="proActiv_files/figure-html/VizMajorGeneExp-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="t-sne" class="section level3">
<h3 class="hasAnchor">
<a href="#t-sne" class="anchor"></a>t-SNE</h3>
<p>We generate a t-SNE plot with all active promoters. Expectedly, replicates from each cell line cluster together.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rtsne</span>)

<span class="co">## Remove inactive promoters (sparse rows)</span>
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">assays</a></span>(<span class="no">result</span>)$<span class="no">absolutePromoterActivity</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="no">.</span>) <span class="kw">&gt;</span> <span class="fl">0</span>)
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">data</span>))
<span class="no">data</span>$<span class="no">Sample</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">condition</span>)

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">42</span>) <span class="co"># for reproducibility</span>

<span class="no">tsne.out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rtsne/man/Rtsne.html">Rtsne</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">data</span>, <span class="kw">select</span> <span class="kw">=</span> -<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">Sample</span>))), <span class="kw">perplexity</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">tsne.out</span>$<span class="no">Y</span>[,<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">tsne.out</span>$<span class="no">Y</span>[,<span class="fl">2</span>], <span class="kw">bg</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">Sample</span>, <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">1</span>,
     <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">24</span>, <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">4</span>,
     <span class="kw">main</span> <span class="kw">=</span> <span class="st">'t-SNE plot with promoters \n active in at least one sample'</span>,
     <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">'T-SNE1'</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">'T-SNE2'</span>,
     <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">180</span>,<span class="fl">180</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">180</span>,<span class="fl">180</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">'topright'</span>, <span class="kw">inset</span> <span class="kw">=</span> <span class="fl">.02</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Cell Lines'</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">condition</span>), <span class="kw">pch</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">24</span>,<span class="fl">24</span>), <span class="kw">pt.bg</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">condition</span>)) , <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">1.5</span>, <span class="kw">bty</span> <span class="kw">=</span> <span class="st">'n'</span>)</pre></body></html></div>
<p><img src="proActiv_files/figure-html/VizTsne-1.png" width="499.2" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="getting-help" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-help" class="anchor"></a>Getting help</h2>
<p>Questions and issues can be raised at the Bioconductor support site: <a href="https://support.bioconductor.org" class="uri">https://support.bioconductor.org</a>. Ensure your posts are tagged with <code>proActiv</code>.</p>
<p>Alternatively, issues can be raised at the proActiv Github repository: <a href="https://github.com/GoekeLab/proActiv" class="uri">https://github.com/GoekeLab/proActiv</a>.</p>
</div>
<div id="citing-proactiv" class="section level2">
<h2 class="hasAnchor">
<a href="#citing-proactiv" class="anchor"></a>Citing proActiv</h2>
<p>If you use proActiv, please cite:</p>
<p><a href="https://www.cell.com/cell/fulltext/S0092-8674(19)30906-7">Demircioğlu, Deniz, et al. “A Pan-cancer Transcriptome Analysis Reveals Pervasive Regulation through Alternative Promoters.” <em>Cell</em> 178.6 (2019): 1465-1477.</a></p>
</div>
<div id="session-information" class="section level2">
<h2 class="hasAnchor">
<a href="#session-information" class="anchor"></a>Session information</h2>
<pre><code>#&gt; R version 4.0.2 (2020-06-22)
#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)
#&gt; Running under: Windows 10 x64 (build 18362)
#&gt; 
#&gt; Matrix products: default
#&gt; 
#&gt; locale:
#&gt; [1] LC_COLLATE=English_Singapore.1252  LC_CTYPE=English_Singapore.1252   
#&gt; [3] LC_MONETARY=English_Singapore.1252 LC_NUMERIC=C                      
#&gt; [5] LC_TIME=English_Singapore.1252    
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats4    parallel  stats     graphics  grDevices utils     datasets 
#&gt; [8] methods   base     
#&gt; 
#&gt; other attached packages:
#&gt;  [1] Rtsne_0.15                  ggplot2_3.3.2              
#&gt;  [3] GenomicFeatures_1.40.1      DEXSeq_1.34.1              
#&gt;  [5] RColorBrewer_1.1-2          AnnotationDbi_1.50.1       
#&gt;  [7] DESeq2_1.28.1               SummarizedExperiment_1.18.2
#&gt;  [9] DelayedArray_0.14.1         matrixStats_0.56.0         
#&gt; [11] GenomicRanges_1.40.0        GenomeInfoDb_1.24.2        
#&gt; [13] IRanges_2.22.2              S4Vectors_0.26.1           
#&gt; [15] Biobase_2.48.0              BiocGenerics_0.34.0        
#&gt; [17] BiocParallel_1.22.0         proActiv_0.99.0            
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;   [1] colorspace_1.4-1         hwriter_1.3.2            ellipsis_0.3.1          
#&gt;   [4] rprojroot_1.3-2          biovizBase_1.36.0        htmlTable_2.0.1         
#&gt;   [7] XVector_0.28.0           base64enc_0.1-3          fs_1.4.2                
#&gt;  [10] dichromat_2.0-0          rstudioapi_0.11          farver_2.0.3            
#&gt;  [13] bit64_0.9-7              splines_4.0.2            geneplotter_1.66.0      
#&gt;  [16] knitr_1.29               Formula_1.2-3            Rsamtools_2.4.0         
#&gt;  [19] annotate_1.66.0          cluster_2.1.0            dbplyr_1.4.4            
#&gt;  [22] png_0.1-7                compiler_4.0.2           httr_1.4.1              
#&gt;  [25] backports_1.1.7          assertthat_0.2.1         Matrix_1.2-18           
#&gt;  [28] lazyeval_0.2.2           acepack_1.4.1            htmltools_0.5.0         
#&gt;  [31] prettyunits_1.1.1        tools_4.0.2              gtable_0.3.0            
#&gt;  [34] glue_1.4.1               GenomeInfoDbData_1.2.3   dplyr_1.0.1             
#&gt;  [37] rappdirs_0.3.1           Rcpp_1.0.5               pkgdown_1.5.1           
#&gt;  [40] vctrs_0.3.2              Biostrings_2.56.0        rtracklayer_1.48.0      
#&gt;  [43] xfun_0.15                stringr_1.4.0            lifecycle_0.2.0         
#&gt;  [46] ensembldb_2.12.1         statmod_1.4.34           XML_3.99-0.4            
#&gt;  [49] zlibbioc_1.34.0          MASS_7.3-51.6            scales_1.1.1            
#&gt;  [52] BSgenome_1.56.0          VariantAnnotation_1.34.0 hms_0.5.3               
#&gt;  [55] ProtGenerics_1.20.0      AnnotationFilter_1.12.0  yaml_2.2.1              
#&gt;  [58] curl_4.3                 memoise_1.1.0            gridExtra_2.3           
#&gt;  [61] biomaRt_2.44.1           rpart_4.1-15             latticeExtra_0.6-29     
#&gt;  [64] stringi_1.4.6            RSQLite_2.2.0            highr_0.8               
#&gt;  [67] genefilter_1.70.0        desc_1.2.0               checkmate_2.0.0         
#&gt;  [70] rlang_0.4.7              pkgconfig_2.0.3          bitops_1.0-6            
#&gt;  [73] evaluate_0.14            lattice_0.20-41          purrr_0.3.4             
#&gt;  [76] labeling_0.3             GenomicAlignments_1.24.0 htmlwidgets_1.5.1       
#&gt;  [79] bit_1.1-15.2             tidyselect_1.1.0         magrittr_1.5            
#&gt;  [82] R6_2.4.1                 generics_0.0.2           Hmisc_4.4-0             
#&gt;  [85] DBI_1.1.0                withr_2.2.0              pillar_1.4.6            
#&gt;  [88] foreign_0.8-80           survival_3.1-12          RCurl_1.98-1.2          
#&gt;  [91] nnet_7.3-14              tibble_3.0.3             crayon_1.3.4            
#&gt;  [94] BiocFileCache_1.12.0     rmarkdown_2.3            jpeg_0.1-8.1            
#&gt;  [97] progress_1.2.2           locfit_1.5-9.4           grid_4.0.2              
#&gt; [100] data.table_1.13.0        blob_1.2.1               digest_0.6.25           
#&gt; [103] xtable_1.8-4             openssl_1.4.2            munsell_0.5.0           
#&gt; [106] Gviz_1.32.0              askpass_1.1</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Deniz Demircioglu, Jonathan Göke, Joseph Lee.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
